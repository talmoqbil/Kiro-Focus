# Implementation Plan

- [x] 1. Set up project structure and dependencies
  - [x] 1.1 Initialize React project with Vite and install dependencies
    - Create React app with Vite
    - Install dependencies: lucide-react, fast-check (for testing), tailwindcss
    - Configure Tailwind with dark theme color palette
    - _Requirements: 9.1, 9.2, 9.3, 9.4_
  - [x] 1.2 Create directory structure and base files
    - Create folders: components/, agents/, utils/, data/, hooks/, __tests__/
    - Set up AppContext for global state management
    - Create App.jsx with basic layout structure
    - _Requirements: All_

- [x] 2. Implement credit calculation utilities
  - [x] 2.1 Create creditCalculator.js with all credit formulas
    - Implement calculateBaseCredits(duration)
    - Implement calculateCompletionBonus(baseCredits, pauseCount)
    - Implement calculateStreakBonus(baseCredits, streak)
    - Implement calculateLongSessionBonus(baseCredits, duration)
    - Implement calculatePartialCredits(elapsedTime)
    - Implement calculateTotalCredits(session, streak)
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_
  - [ ]* 2.2 Write property tests for credit calculations
    - **Property 7: Base Credit Calculation**
    - **Property 8: Completion Bonus Calculation**
    - **Property 9: Streak Bonus Calculation**
    - **Property 10: Long Session Bonus Calculation**
    - **Property 5: Partial Credit Calculation for Abandonment**
    - **Validates: Requirements 2.1, 2.2, 2.3, 2.4, 2.5, 1.6**

- [x] 3. Implement timer logic and component
  - [x] 3.1 Create timerLogic.js with timer state management
    - Implement startTimer(duration) returning initial state with startTime timestamp
    - Implement pauseTimer(state) returning paused state
    - Implement resumeTimer(state) returning resumed state
    - Implement tickTimer(state) with drift correction (compare to startTime)
    - Implement calculateProgress(state) returning percentage
    - Implement isFinalMinute(state) returning boolean
    - Implement correctDrift(state) to fix >2s drift using timestamps
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.7, 12.1, 12.2, 12.3_
  - [ ]* 3.2 Write property tests for timer logic
    - **Property 1: Timer Countdown Accuracy**
    - **Property 2: Progress Ring Calculation**
    - **Property 3: Pause and Resume Consistency**
    - **Property 4: Session Completion Detection**
    - **Property 6: Final Minute Detection**
    - **Property 23: Timer Accuracy Under Throttling**
    - **Validates: Requirements 1.1, 1.2, 1.3, 1.4, 1.5, 1.7, 12.1, 12.2, 12.3**
  - [x] 3.3 Create Timer.jsx component
    - Implement duration preset buttons (15, 25, 45, 60, 90 min)
    - Implement countdown display in MM:SS format
    - Implement circular progress ring SVG
    - Implement start/pause/resume/stop controls
    - Apply final minute styling (orange, pulse)
    - Implement useEffect cleanup to clear intervals on unmount
    - Wire up to AppContext for state and credit awarding
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 12.4_

- [x] 4. Implement Kiro mascot component
  - [x] 4.1 Create kiroLogic.js for emotion state management
    - Implement getEmotionForEvent(event) mapping events to emotions
    - Get the Kiro mascot image from online or ask the user to do this manual
    - Implement message queue management (enqueue, dequeue, peek)
    - _Requirements: 3.2, 3.3, 3.4, 3.5, 3.7_
  - [ ]* 4.2 Write property tests for Kiro logic
    - **Property 11: Kiro Emotion State Transitions**
    - **Property 12: Message Queue Ordering**
    - **Validates: Requirements 3.2, 3.3, 3.4, 3.5, 3.7**
  - [x] 4.3 Create KiroMascot.jsx component
    - Implement ghost SVG/CSS with semi-transparent body and purple glow
    - Implement 5 emotion animations (idle, encouraging, celebrating, concerned, teaching)
    - Implement speech bubble with typewriter effect (30ms per character)
    - Implement message queue display logic with auto-dismiss
    - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [x] 5. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 6. Implement component shop
  - [x] 6.1 Create components.js data file with component catalog
    - Define all 5 components (EC2, S3, RDS, LoadBalancer, CloudFront)
    - Include all fields: id, type, name, descriptions, icon, cost, tier (always 1 for Phase 1), prerequisites, category, realWorldExample
    - Note: upgradeTree included in data but upgrade UI deferred to Phase 2
    - _Requirements: 4.1_
  - [x] 6.2 Create shopLogic.js with purchase logic
    - Implement canPurchase(component, credits, ownedComponents)
    - Implement checkPrerequisites(component, ownedComponents)
    - Implement processPurchase(component, credits, ownedComponents)
    - _Requirements: 4.2, 4.3, 4.4, 4.5_
  - [ ]* 6.3 Write property tests for shop logic
    - **Property 13: Purchase Availability Based on Credits**
    - **Property 14: Prerequisite Checking**
    - **Property 15: Purchase Transaction Integrity**
    - **Validates: Requirements 4.2, 4.3, 4.4, 4.5**
  - [x] 6.4 Create Modal.jsx reusable component
    - Generic modal wrapper with overlay and close button
    - Content slot for flexible usage
    - Escape key to close
    - Centralized z-index management
    - _Requirements: 4.6, 5.5_
  - [x] 6.5 Create ComponentCard.jsx component
    - Display component icon, name, description, cost
    - Implement available/insufficient/locked visual states
    - Implement purchase button with appropriate styling
    - _Requirements: 4.1, 4.2, 4.3, 4.4_
  - [x] 6.6 Create ComponentShop.jsx component
    - Display grid of ComponentCards
    - Implement "More Info" modal with full description and real-world example
    - Wire up purchase flow to AppContext
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [x] 7. Implement infrastructure canvas
  - [x] 7.1 Create canvasLogic.js with grid and placement logic
    - Implement snapToGrid(position) returning snapped coordinates
    - Implement isValidPlacement(position, placedComponents)
    - Implement generateComponentId(type, placedComponents)
    - Note: Connections between components deferred to Phase 2
    - _Requirements: 5.2, 5.3_
  - [ ]* 7.2 Write property tests for canvas logic
    - **Property 16: Grid Snap Calculation**
    - **Property 17: Empty State Detection**
    - **Validates: Requirements 5.2, 5.3, 5.6**
  - [x] 7.3 Create InfrastructureCanvas.jsx component
    - Implement 800x600 canvas with 40x40 grid background
    - Implement drag-and-drop with ghost preview
    - Implement snap-to-grid placement
    - Implement component hover highlighting and tooltips
    - Implement component click for info modal (remove option only, upgrades Phase 2)
    - Implement empty state message
    - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x] 8. Implement session history and statistics
  - [x] 8.1 Create sessionHistory.js with history logic
    - Implement groupSessionsByDate(sessions)
    - Implement calculateStatistics(sessions)
    - Implement calculateStreak(sessions)
    - _Requirements: 6.1, 6.2, 6.3_
  - [ ]* 8.2 Write property tests for session history logic
    - **Property 18: Session Grouping by Date**
    - **Property 19: Session Display Completeness**
    - **Property 20: Statistics Calculation**
    - **Validates: Requirements 6.1, 6.2, 6.3**
  - [x] 8.3 Create SessionHistory.jsx component
    - Display sessions grouped by date with completion icons
    - Display summary statistics panel
    - Implement export button triggering JSON download
    - Implement import button with file picker
    - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 9. Implement export/import functionality
  - [x] 9.1 Create storageHelpers.js with export/import logic
    - Define CURRENT_VERSION constant ("1.0.0")
    - Implement exportData(userProgress, architecture) returning JSON string with version
    - Implement validateImportData(jsonString) with version checking
    - Implement importData(jsonString) returning parsed state or error
    - Reject imports with version mismatch
    - _Requirements: 10.2, 10.3, 10.4, 10.5, 10.6_
  - [ ]* 9.2 Write property tests for export/import
    - **Property 21: Export/Import Round-Trip**
    - **Property 24: Export Version Validation**
    - **Validates: Requirements 6.4, 6.5, 10.2, 10.3, 10.4, 10.5, 10.6**

- [x] 10. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 11. Implement AI agent system
  - [x] 11.1 Create agentPrompts.js with system prompts
    - Define FOCUS_COACH_SYSTEM_PROMPT constant
    - Define ARCHITECT_AGENT_SYSTEM_PROMPT constant
    - _Requirements: 7.1, 8.1_
  - [x] 11.2 Create kiroDialogue.js with fallback messages
    - Define fallback messages for each agent mode (encouragement, analysis, motivation, supportive)
    - Define fallback architect explanations for each component type
    - Define generic error recovery messages
    - _Requirements: 11.1, 11.3_
  - [x] 11.3 Create agentApiClient.js with API wrapper
    - Implement callAgentAPI(prompt, maxTokens) with 5s timeout
    - Implement retry logic (1 retry on timeout)
    - Implement rate limiter (max 5 messages/hour)
    - Implement error logging and fallback triggering
    - _Requirements: 11.1, 11.2, 11.3, 11.4, 11.5_
  - [x] 11.4 Create focusCoachAgent.js
    - Implement buildFocusCoachInput(mode, sessionData)
    - Implement callFocusCoachAgent(input) using agentApiClient
    - Implement parseFocusCoachResponse(response) with defaults for missing fields
    - Wire fallback messages from kiroDialogue.js on error
    - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 11.4_
  - [x] 11.5 Create architectAgent.js
    - Implement buildArchitectInput(components, credits, lastAction)
    - Implement callArchitectAgent(input) using agentApiClient
    - Implement parseArchitectResponse(response) with defaults for missing fields
    - Wire fallback messages from kiroDialogue.js on error
    - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 11.4_
  - [x] 11.6 Create useAgents.js custom hook
    - Implement useFocusCoach() hook with session event handlers
    - Implement useArchitect() hook with purchase event handlers
    - Implement re-engagement detection (daysSinceLastSession >= 1)
    - Wire agent responses to Kiro message display
    - _Requirements: 7.1, 7.2, 7.3, 7.4, 8.1, 8.3, 8.4_
  - [ ]* 11.7 Write property tests for agent system
    - **Property 22: Re-engagement Detection**
    - **Property 25: Agent Rate Limiting**
    - **Validates: Requirements 7.4, 11.5**
  - [ ]* 11.8 Write unit tests for agent integration
    - Test: Agent API call constructs correct request body
    - Test: Agent response parsing handles all JSON fields
    - Test: Agent fallback messages display on timeout
    - Test: Agent messages trigger correct Kiro emotions
    - _Requirements: 11.1, 11.2, 11.3, 11.4_

- [x] 12. Implement credit display component
  - [x] 12.1 Create CreditDisplay.jsx component
    - Display current credits with lightning bolt icon
    - Implement animated counter (incremental counting, not instant)
    - Implement scale-up animation on change
    - Implement green flash for gains, red flash for spending
    - Implement low credits warning state (< 50 credits)
    - _Requirements: 2.6_

- [x] 13. Wire up complete application flow
  - [x] 13.1 Integrate all components in App.jsx
    - Set up navigation between views (timer, shop, canvas, history)
    - Wire Timer completion to credit awarding and Focus Coach
    - Wire Shop purchase to Architect Agent
    - Wire Canvas view to Architect validation
    - Ensure Kiro mascot receives all agent messages
    - _Requirements: All_
  - [x] 13.2 Apply consistent dark theme styling
    - Apply background color #0a0e27 to all views
    - Apply purple accent #b794f6 to interactive elements
    - Apply success green #48bb78 and warning orange #ed8936
    - Apply purple glow to Kiro mascot
    - Ensure smooth 60fps animations
    - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [x] 14. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [-] 15. (OPTIONAL) Phase 2 Stretch Goals
  - [x] 15.1 Implement component upgrade system
    - Add "Upgrade" button to placed component info modal
    - Implement upgrade cost deduction and tier increment
    - Trigger Architect Agent explanation of tier benefits
    - _Requirements: 4.6 (extended)_
  - [x] 15.2 Implement connection system
    - Add "Connect Mode" button to canvas
    - Click component A, then component B to create connection
    - Draw dashed line between components with animated data flow
    - Store connections in architecture state
    - _Requirements: 5.4 (extended)_
  - [x] 15.3 Implement MCP integration for session persistence
    - Set up filesystem MCP for session log file
    - Auto-save sessions to local file on completion
    - Auto-load sessions on app start
    - _Requirements: 10.2 (extended)_
